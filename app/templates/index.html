{% extends "base.html" %}
{% from "_formhelpers.html" import render_field %}

{% block styles %}
<style type="text/css">
    .liked{
        color:red!important
    }
    .no-liked{
        color:#6c757d!important
    }
</style>

{% endblock styles %}

{% block app_content %}
<h1>你好, {{ current_user.username }}!</h1>
{% if form %}
    <form method='post' >
       {{form.hidden_tag() }}
       {{render_field(form.post,class="form-control",row=3)}}
       {{form.submit}}
    </form>
{% endif %}
 
{% for post in posts %}
    {% include '_post.html' %}
{% endfor %}
{% if prev_url%}<a href="{{prev_url}}">上一页</a>{% endif%}
{% if next_url%}<a href="{{next_url}}">下一页</a>{% endif%}

<nav aria-label="...">
  <ul class="pagination">
    <li class="{{'page-item' if pagination.has_prev else 'page-item disabled'}}">
      <a class="page-link" href="{{url_for('main.index',page=pagination.prev_num if pagination.has_prev else None)}}" tabindex="-1" aria-disabled="true">上一页</a>
    </li>
    {% for i in range(1,pagination.pages+1) %}
        {% if i==pagination.page%}
            <li class="page-item active" aria-current="page">
        {%else%}
            <li class="page-item">
        {% endif%}
        <a class="page-link" href="{{url_for('main.index',page=i)}}">{{i}} <span class="sr-only">(current)</span></a>
        </li>
        {%if i>10 %}
         <li class="page-item">
         <a class="page-link" href="{{url_for('main.index',page=i)}}">...</a>
        </li>
        {%endif%}
    {% endfor %}
     <li class="{{'page-item' if pagination.has_next else 'page-item disabled'}}">
      <a class="page-link" href="{{url_for('main.index',page=pagination.next_num if pagination.has_next else None)}}">
      下一页 </a>
    </li>
  </ul>
</nav>

{% endblock %}

{% block scripts %}
<script type="text/javascript" src="{{url_for('static',filename='axios/axios.js')}}"></script>
<script>
    $(function(){
 
        html_moment_render_all();

        $('.likes').each(
            function(){
                var postid=$(this).data('postid');
                //点赞处理
                $(this).click(function(){
                    if($(this).hasClass('liked')) {
                        $(this).removeClass('liked').addClass('text-muted').children('.fa-thumbs-up').removeClass('fa-thumbs-up').addClass('fa-thumbs-o-up');
                        $(this).children('.count').text(parseInt($(this).children('.count').text()) - 1);
                    }else{
                        $(this).addClass('liked').removeClass('text-muted').children('.fa-thumbs-o-up').removeClass('fa-thumbs-o-up').addClass('fa-thumbs-up');
                        $(this).children('.count').text(parseInt($(this).children('.count').text()) + 1);
                    }

                    axios.post('/api/likes/'+postid,{'postid':postid})
                    .then(function(response){  
                        console.log(response);
                    })
                    .catch(function(error){
                        console.log(error);
                    });
                });
            }
        );
    });
</script>
{% endblock scripts %}